<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AutoSlides Preferences</title>
    <link rel="stylesheet" href="preferences.css">
</head>
<body>
    <div class="preferences-container">
        <div class="preferences-header">
            <h1>AutoSlides Preferences</h1>
        </div>
        
        <div class="tabs">
            <div class="tab active" data-tab="general">General</div>
            <div class="tab" data-tab="capture">Capture</div>
            <div class="tab" data-tab="profiles">Profiles</div>
            <div class="tab" data-tab="automation">Handler</div>
        </div>

        <!-- Add scrollable content area wrapper -->
        <div class="content-scroll-area">
        
            <!-- General Tab -->
            <div class="tab-content active" id="general-tab">
                <div class="preference-section">
                    <div class="preference-item">
                        <label for="darkModeSelect">Appearence:</label>
                        <select id="darkModeSelect">
                            <option value="system">Follow System</option>
                            <option value="light">Light</option>
                            <option value="dark">Dark</option>
                        </select>
                    </div>
                </div>

                <div class="preference-section">
                    <div class="preference-item">
                        <label>
                            <input type="checkbox" id="allowBackgroundRunning">
                            Keep Running in Background
                        </label>
                        <div class="help-text">
                            Prevents the system from sleeping while AutoSlides is running
                        </div>
                    </div>
                </div>

                <div class="preference-section">
                    <h3>Remote Management</h3>
                    
                    <div class="preference-item">
                        <label>
                            <input type="checkbox" id="enable-remote" class="toggle">
                            Enable Remote Management
                        </label>
                        <div class="help-text">
                            Manage AutoSlides remotely on your local network
                        </div>
                    </div>
                    
                    <div class="preference-item">
                        <label for="remote-port">Port Number</label>
                        <div class="preference-control">
                            <input type="number" id="remote-port" min="1024" max="65535" value="8080">
                        </div>
                    </div>
                    
                    <div class="preference-item">
                        <label for="remote-username">Username</label>
                        <div class="preference-control">
                            <input type="text" id="remote-username">
                        </div>
                    </div>
                    
                    <div class="preference-item">
                        <label for="remote-password">Password</label>
                        <div class="preference-control">
                            <input type="password" id="remote-password">
                        </div>
                    </div>
                </div>
                
                <div class="preference-section">
                    <h3>Cache Management</h3>
                    
                    <div class="preference-item">
                        <label for="cacheCleanInterval">Auto-Clean Interval (mins):</label>
                        <input type="number" id="cacheCleanInterval" min="0" max="60" step="5" value="15" />
                        <div class="help-text">Set to 0 to disable auto-cleaning</div>
                    </div>
                    
                    <div class="buttons-group">
                        <button id="btnClearCookies">Clear Cookies</button>
                        <button id="btnClearAll">Clear All Data</button>
                    </div>
                </div>
            </div>

            <!-- Capture Strategy Tab -->
            <div class="tab-content" id="capture-tab">
                <div class="preference-header-warning">
                    <p>Avoid changing defaults unless required. Modifications may cause instability.</p>
                </div>
                
                <!-- Default Strategy Card -->
                <div class="preference-section">
                    <div class="strategy-card default-strategy">
                        <div class="strategy-header">
                            <h3>Default</h3>
                            <span class="strategy-badge">pHash & SSIM</span>
                        </div>

                        <div class="strategy-section">
                            <div class="settings-grid">
                                <div class="preference-item">
                                    <div class="setting-with-info">
                                        <span class="setting-label">Grayscale Conversion</span>
                                        <span class="setting-value">Enabled</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <hr class="section-divider">
                        
                        <!-- Primary Filtering Section -->
                        <div class="strategy-section">
                            <div class="settings-grid">
                                <div class="preference-item">
                                    <div style="height: 12px;"></div>
                                    <div class="setting-with-info">
                                        <span class="setting-label">Resizing</span>
                                        <span class="setting-value">Enabled</span>
                                    </div>
                                    <div style="height: 12px;"></div>
                                    <div class="setting-with-info">
                                        <span class="setting-label">DCT</span>
                                        <span class="setting-value">Enabled</span>
                                    </div>
                                    <div style="height: 12px;"></div>
                                    <div class="setting-with-info">
                                        <span class="setting-label">pHash</span>
                                        <span class="setting-value">Enabled</span>
                                    </div>
                                </div>

                                <div class="preference-item">
                                    <label for="hammingThreshold">Hamming Distance Threshold:</label>
                                    <input type="number" id="hammingThresholdLow" min="0" max="10" step="1" value="0">
                                    <div class="help-text">Bypass SSIM check if below lower threshold</div>
                                    <input type="number" id="hammingThresholdUp" min="0" max="20" step="1" value="5">
                                    <div class="help-text">Bypass SSIM check if above upper threshold</div>
                                </div>
                            </div>
                        </div>
                        
                        <hr class="section-divider" style="margin: 0 0 25px 0;">
                        
                        <!-- Secondary Filtering Section -->
                        <div class="strategy-section">
                            <div class="settings-grid">
                                <div class="preference-item">
                                    <div style="height: 22px;"></div>
                                    <div class="setting-with-info">
                                        <span class="setting-label">SSIM</span>
                                        <span class="setting-value">Enabled</span>
                                    </div>
                                </div>
                                <div class="preference-item">
                                    <label for="ssimThreshold">SSIM Threshold:</label>
                                    <input type="number" id="ssimThreshold" min="0.95" max="1" step="0.0001" value="0.999">
                                    <div class="help-text">Minimum similarity for images equivalent</div>
                                </div>
                            </div>
                        </div>
                    </div>
                
                    <!-- Basic Strategy Card -->
                    <div class="strategy-card basic-strategy">
                        <div class="strategy-header">
                            <h3>Basic</h3>
                            <span class="strategy-badge">Pixel</span>
                        </div>
                        
                        <!-- Preprocessing Section -->
                        <div class="strategy-section">
                            <div class="settings-grid">
                                <div class="preference-item">
                                    <div style="height: 10px;"></div>
                                    <div class="setting-with-info">
                                        <span class="setting-label">Grayscale Conversion</span>
                                        <span class="setting-value">Enabled</span>
                                    </div>
                                    <div style="height: 10px;"></div>
                                    <div class="setting-with-info">
                                        <span class="setting-label">Gaussian Blur</span>
                                        <span class="setting-value">Enabled</span>
                                    </div>
                                </div>
                                
                                <div class="preference-item">
                                    <label for="gaussianBlurSigma">Sigma:</label>
                                    <input type="number" id="gaussianBlurSigma" min="0.1" max="2.0" step="0.1" value="0.5">
                                    <div class="help-text">Higher values increase blur strength</div>
                                </div>
                            </div>
                        </div>
                        
                        <hr class="section-divider" style="margin: 0 0 25px 0;">
                        
                        <!-- Filtering Section -->
                        <div class="strategy-section">
                            <h4></h4>
                            <div class="settings-grid">
                                <div class="preference-item">
                                    <!-- Pixel Difference Threshold -->
                                    <div class="setting-label">Pixel Difference Threshold:</div>
                                    <div class="setting-control">
                                        <input type="number" id="pixelDiffThreshold" min="1" max="255" step="1" value="30">
                                        <div class="help-text">Threshold for considering pixels different</div>
                                    </div>
                                </div>
                                
                                <div class="preference-item">
                                    <!-- Change Ratio Threshold -->
                                    <div class="setting-label">Change Ratio Threshold:</div>
                                    <div class="setting-control">
                                        <input type="number" id="changeRatioThreshold" min="0.001" max="0.02" step="0.001" value="0.005">
                                        <div class="help-text">Minimum ratio of pixels to trigger changes.</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Double Verification Settings -->
                <div class="preference-section">
                    <h3>​Secondary Verification​</h3>
                    <div class="preference-item">
                        <div class="setting-label">Stability Threshold:</div>
                        <div class="setting-control">
                            <input type="number" id="verificationCount" min="1" max="5" step="1" value="2">
                            <div class="help-text">Number of consecutive stability checks before accepting a new slide</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Optimization Profiles Tab -->
            <div class="tab-content" id="profiles-tab">
                <!-- Default Profile Section - NEW -->
                <div class="preference-section default-profile">
                    <div class="profile-card built-in" data-profile-id="default">
                        <div class="profile-header">
                            <h4 class="profile-name">Default (Full Page)</h4>
                            <button id="btnShowCropGuides" class="preview-link">Preview Crop</button>
                        </div>
                        
                        <p class="help-text">The default profile captures the entire webpage with cropping (apply only to Default profile).</p>
                        
                        <hr class="section-divider">
                        
                        <!-- Cropping Settings Group -->
                        <div class="settings-grid">
                            <div class="preference-item">
                                <label for="inputTopCrop">Top Crop (%):</label>
                                <input type="number" id="inputTopCrop" class="topCropPercent" step="1" min="0" max="40" value="5" />
                            </div>
                            
                            <div class="preference-item">
                                <label for="inputBottomCrop">Bottom Crop (%):</label>
                                <input type="number" id="inputBottomCrop" class="bottomCropPercent" step="1" min="0" max="40" value="5" />
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Built-in Profiles Section -->
                <div class="preference-section built-in-profiles">
                    <div class="profiles-grid">
                        <!-- Built-in profile sections will be added dynamically -->
                    </div>
                </div>
                
                <!-- New Profile Creation (Now in the middle) -->
                <div class="preference-section profile-creation">
                    <div class="create-profile-row">
                        <div class="preference-item">
                            <label for="newProfileName">Create New Profile:</label>
                            <input type="text" id="newProfileName" placeholder="Enter profile name">
                        </div>
                        <button id="btnCreateProfile" class="action-button">Create Profile</button>
                    </div>
                </div>
                
                <!-- Custom Profiles Section -->
                <div class="preference-section custom-profiles">
                    <div class="profiles-grid">
                        <!-- Custom profile sections will be added dynamically -->
                    </div>
                </div>
                
                <!-- Template for profiles -->
                <template id="profileTemplate">
                    <div class="profile-card" data-profile-id="">
                        <div class="profile-header">
                            <h4 class="profile-name"></h4>
                            <button class="profile-delete-btn" title="Delete profile">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </button>
                        </div>
                        
                        <!-- Basic Configuration Group -->
                        <div class="settings-grid">
                            <div class="preference-item">
                                <label for="profileElementSelector">Element Selector:</label>
                                <input type="text" class="profileElementSelector" placeholder="#video_id_topPlayer_html5_api">
                                <div class="help-text">Only the selected element will be captured</div>
                            </div>
                            
                            <div class="preference-item">
                                <label for="profileUrlPattern">URL Patterns:</label>
                                <input type="text" class="profileUrlPattern" placeholder="example.com/video">
                                <div class="help-text">Patterns to auto-select this profile</div>
                            </div>
                        </div>
                        
                        <hr class="section-divider">
                        
                        <!-- Playback Detection Group -->
                        <div class="settings-grid">
                            <div class="preference-item">
                                <label for="profileEndDetectionSelector">End Detection Selector:</label>
                                <input type="text" class="profileEndDetectionSelector" placeholder=".player-ended-poster">
                            </div>
                            
                            <div class="preference-item">
                                <label for="profilePlayButtonSelector">Play Button Selector:</label>
                                <input type="text" class="profilePlayButtonSelector" placeholder=".play-button">
                            </div>
                        </div>
                        
                        <div class="settings-grid">
                            <div class="preference-item">
                                <label for="profileCountdownSelector">Countdown Selector:</label>
                                <input type="text" class="profileCountdownSelector" placeholder=".countdown">
                            </div>
                        </div>
                        
                        <hr class="section-divider">
                        
                        <!-- Speed Settings Group -->
                        <div class="settings-grid">
                            <div class="preference-item">
                                <label for="profileSpeedSelector">Speed Selector:</label>
                                <input type="text" class="profileSpeedSelector" placeholder="#video_element">
                            </div>
                            
                            <div class="preference-item">
                                <label for="profilePlaybackSpeed">Adjusted Playback Speed:</label>
                                <select class="profilePlaybackSpeed">
                                    <option value="1.0">1.0x</option>
                                    <option value="1.5">1.5x</option>
                                    <option value="2.0">2.0x</option>
                                    <option value="2.5">2.5x</option>
                                    <option value="3.0">3.0x</option>
                                    <option value="4.0">4.0x</option>
                                    <option value="5.0">5.0x</option>
                                </select>
                            </div>
                        </div>
                        
                        <hr class="section-divider">
                        
                        <!-- Title Detection Group -->
                        <div class="settings-grid">
                            <div class="preference-item">
                                <label for="profileCourseTitleSelector">Course Title Selector:</label>
                                <input type="text" class="profileCourseTitleSelector" placeholder=".course-title">
                                <div class="help-text">Used when "Auto-detect title" is enabled</div>
                            </div>
                            
                            <div class="preference-item">
                                <label for="profileSessionInfoSelector">Session Info Selector:</label>
                                <input type="text" class="profileSessionInfoSelector" placeholder=".session-info">
                            </div>
                        </div>
                        
                        <hr class="section-divider">
                        
                        <!-- Error Handling Group -->
                        <div class="settings-grid">
                            <div class="preference-item">
                                <label for="profileErrorSelector">Error Selector:</label>
                                <input type="text" class="profileErrorSelector" placeholder=".error-message">
                                <div class="help-text">Used when "Auto-retry on error" is enabled</div>
                            </div>
                            
                            <div class="preference-item">
                                <label for="profileMaxRetryAttempts">Max Retry Attempts:</label>
                                <input type="number" class="profileMaxRetryAttempts" min="1" max="10" value="3">
                            </div>
                        </div>
                    </div>
                </template>
            </div> 
            <!-- Website Handler Tab -->
            <div class="tab-content" id="automation-tab">
                <div class="preference-section">
                    <h3>Authentication</h3>
                    
                    <div class="preference-item">
                        <label for="tokenField">YanHeKT Authentication Token for API Communication:</label>
                        <div class="token-row">
                            <button id="btnRetrieveToken" class="action-button token-retrieve-btn">Retrieve Token</button>
                            <div class="password-container">
                                <input type="password" id="tokenField" readonly>
                                <div class="password-actions">
                                    <button id="btnCopyToken" class="icon-button" title="Copy to Clipboard">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <rect x="9" y="9" width="13" height="13" rx="2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            <path d="M5 15H4C2.89543 15 2 14.1046 2 13V4C2 2.89543 2.89543 2 4 2H13C14.1046 2 15 2.89543 15 4V5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                    </button>
                                    <button id="btnTogglePassword" class="icon-button" title="Show/Hide Password">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M2 12s3.5-7 10-7 10 7 10 7-3.5 7-10 7-10-7-10-7z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div id="tokenStatus" class="token-status"></div>
                    </div>
                </div>

                <div class="preference-section" id="course-info-section">
                    <h3>Recorded Course Information</h3>
                    <div class="token-container">
                        <div class="token-row">
                            <button id="fetch-courses-btn" class="token-action-button">Fetch Course Data</button>
                            <span id="courses-status" class="courses-status">Click to fetch your private course list</span>
                        </div>
                    </div>
                    <div class="course-container">
                        <div id="course-list-container" class="scrollable-horizontal">
                        <!-- Course cards will be inserted here -->
                        </div>
                    </div>
                </div>

                <div class="preference-section" id="session-info-section">
                    <h3>Course Sessions Information</h3>
                    <div class="token-container">
                        <div class="token-row">
                            <button id="fetch-sessions-btn" class="token-action-button">Fetch Sessions</button>
                            <input type="text" id="session-course-id" class="course-id-input" placeholder="Enter Course ID">
                            <span id="sessions-status" class="courses-status">Enter a course ID or get course info above</span>
                        </div>
                    </div>
                    <div class="course-container">
                        <div id="session-list-container" class="scrollable-horizontal">
                        <!-- Session cards will be inserted here -->
                        </div>
                    </div>
                </div>

                <div class="preference-section" id="live-courses-section">
                    <h3>Live Courses Information</h3>
                    <div class="token-container">
                        <div class="token-row">
                            <button id="fetch-live-courses-btn" class="token-action-button">Fetch Live Sessions</button>
                            <span id="live-courses-status" class="courses-status">Click to fetch available live courses</span>
                        </div>
                    </div>
                    <div class="course-container">
                        <div id="live-course-list-container" class="scrollable-horizontal">
                        <!-- Live course cards will be inserted here -->
                        </div>
                    </div>
                </div>

                <div class="preference-section">
                    <h3>Element Blocking Rules</h3>
                    <p class="help-text">AdGuard-like rules (one per line)</p>
                    <div class="code-editor-container">
                        <textarea id="blockingRules" rows="8" spellcheck="false" wrap="off"></textarea>
                    </div>
                </div>
            </div>

        </div>
        
        <div class="buttons-container">
            <button id="btnDefault">Restore Defaults</button>
            <button id="btnCancel">Cancel</button>
            <button id="btnSave">Save</button>
        </div>
    </div>

    <script src="preferences.js"></script>
</body>
</html>