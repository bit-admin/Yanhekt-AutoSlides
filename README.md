# AutoSlides

[**English Version**](README_EN.md) 👈 Click here for English

`AutoSlides`是一个自动从网页中捕获幻灯片的工具，支持监控内容变化并保存新幻灯片的截图。为北理工延河课堂设计，兼容各类直播/录播平台。
- 基于Electron框架
- 支持Windows/macOS
- 针对延河课堂专门优化

想要在上课时使用移动设备自动捕获幻灯片吗？你也可以使用网页版 [RUC Student Portal](https://learn.ruc.edu.kg) 查看全校直播课程，运行基础的提取幻灯片功能。


## 简介

AutoSlides 能够自动检测并捕获幻灯片变化，保存为高质量PNG图像。软件采用先进的图像比较算法，精确识别真正的内容变化，避免因视频噪点、弹幕或界面元素导致的误触发。

它还可以和其它一些项目搭配使用：
- AutoSlides 项目基于“在播放时进行检测”，因此不必下载原视频文件。
- [Yanhekt Downloader](https://github.com/bit-admin/Yanhekt-downloader-electron) 是基于 electron 的延河课堂视频下载器，可以将课程下载到本地。
- [AutoSlides Extractor](https://github.com/bit-admin/AutoSlides-extractor) 工具可以自动从下载好的视频中提取幻灯片，并将其保存为图片。


## 安装

### macOS

1. 前往发布（Releases）页面下载最新版本
2. 下载适用于您架构（Intel `x64` 或 Apple Silicon `arm64`）的最新 `.dmg` 文件（如：`AutoSlide-1.0.0-macOS-arm64.dmg`）
3. 打开 `.dmg` 文件，将应用拖入 `Applications` 文件夹
4. 首次运行应用程序时，您可能会收到安全警告。要绕过此警告，请执行以下命令：
   ```bash
   sudo xattr -d com.apple.quarantine /Applications/AutoSlides.app
   ```
5. 现在您可以从 `Applications` 启动应用

### Windows

1. 前往发布（Releases）页面下载最新版本
2. 下载适用于您架构（通常为 `x64`）的最新 `.exe` 安装包（如：`AutoSlide-Setup-1.0.0-Windows-x64.exe`）。
3. 运行安装包，按向导完成安装
4. 可选择安装路径、是否创建桌面快捷方式等
5. 安装完成后，从开始菜单或桌面快捷方式启动应用

## 使用方法

### 基本功能
1. **网页加载**：输入视频URL或直接从主页选择课程
2. **开始捕获**：点击"开始捕获"按钮，软件会自动监控视频内容变化
3. **幻灯片保存**：检测到新的幻灯片时，会自动截图并保存到指定文件夹
4. **自动命名**：文件会按时间戳和课程名称自动组织和命名
5. **截取设置**：选择策略组，并可调整截取频率
6. **语言选择**：支持英文、简体中文、繁体中文（在 菜单栏>选项/Mac上为“AutoSlides”>偏好设置 中调整语言设置，默认为英文）

### 高级功能
1. **课程管理**：

基于针对延河课堂的优化配置文件，当打开延河课堂的课程网站时，可：
   - 自动检测延河课堂的课程列表
   - 自动在网页中注入“添加到任务“按钮
   - 支持批量添加录播或直播课程到任务队列
   - 任务队列管理和自动处理

2. **自动化选项**：

在优化配置文件启用时，以下功能除了自动调整播放速度将默认启用：
   - 自动检测视频结束并停止捕获
   - 自动开始播放视频
   - 自动调整播放速度（可超越网站限制，加速到至高5倍速）
   - 自动检测并提取课程标题信息
   - 自动重试错误播放

3. **任务管理和快速模式**：

快速模式在使用任务管理器管理任务时可启用，但由于延河课堂的优化以及网速等原因，可能会由于播放卡顿导致一定的错漏。如果网络不佳，你可以选择使用“自动调整播放速度”功能（在 菜单栏>选项/Mac上为“AutoSlides”>偏好设置 中调整具体速度，例如调整为3倍速）；或者你也可以使用搭配项目下载课程视频。
   - 启用后自动以4倍速播放录播内容
   - 缩短检查间隔至0.5秒提高捕获效率
   - 可自动重置播放进度
   - 可自动静音播放

4. **图像处理选项**：

在针对延河课堂网站的优化配置文件启用时，将会只截取特定元素（课程屏幕录制），无需您进行调整，保持默认播放设置即可。
   - 在网页截取配置下可以进行顶部/底部裁剪百分比调整
   - 支持多种图像比较算法策略组切换
   - 双重验证机制避免误捕获（我们假设讲演者将会在幻灯片时停留一定时间进行讲解，因此我们将只截取“稳定”的幻灯片）

5. **界面优化**：
   - 自定义元素屏蔽规则
   - 界面暗色模式支持
   - 一个精美的主页

6. **缓存管理**：
   - 一键清理浏览器缓存
   - 定期自动清理缓存
   - 显示当前缓存大小

7. **远程管理**：

在偏好设置中启动远程管理功能后，你可以在局域网中使用本机 IP 地址和设置的端口（默认是 11150）进行远程管理，方面您可以把电脑留在宿舍，而只需要连接到同一个校园网（或者使用个人 VPN，例如 `Tailscale` ）便可进行管理。
   - 可在浏览器中输入 `localhost:11150` 进行测试
   - 针对移动设备进行优化
   - 需要先在 Autoslides 主程序登录延河课堂，不可远程登录
   - 通过发送 API 请求与延河课堂服务器进行通信，获取课程详细信息并添加到任务列表
   - 重新打开网页也可实时查看任务进行状态


## 配置选项

软件配有单独的偏好设置界面，在 菜单栏 > 选项 / Mac上为 “AutoSlides” > 偏好设置 打开。

### 基础设置
- **输出目录**：设置幻灯片保存位置
- **检查间隔**：调整内容变化检测频率（秒）
- **网站配置**：针对不同网站的捕获配置文件（可自动切换）
- **外观、语言、后台运行**：设定程序的基本样式，后台运行将会尝试阻止系统休眠（对于长期不关机的设备可能表现良好）

### 图像捕获策略
- **裁剪百分比**：设置顶部和底部需要裁剪的百分比
- **策略组**：选择基本模式或默认模式（感知哈希及结构相似性指数模式）
- **启用双重验证**：需要连续多次检测到变化才会保存，避免误触发

### 自动化设置
- **检测播放结束**：自动识别视频播放结束并停止捕获
- **自动播放**：将会自动点击播放按钮开始视频（由于延河课堂播放界面限制，采用模拟点击播放按钮的形式实现自动播放）
- **自动等待直播开始**：自动识别倒计时，等待课程直播开始
- **自动速度调整**：自动设置视频播放速度
- **自动标题检测**：自动识别并提取课程标题信息（这些信息采用识别网页内容的方式获取以避免 API 回复解析错误，信息将用于创建子文件夹）
- **自动错误重试**：自动在检测到播放错误元素时刷新网页重试

### 批处理选项
- **快速模式**：最大化加速录播内容处理
- **重置进度**：自动重置播放进度，避免跳过内容
- **自动静音**：处理过程中静音播放


## 技术实现

### 图像对比算法
AutoSlides采用多层级图像对比策略，确保准确捕获内容变化：

- **基础模式 (`basic`)**：计算两帧之间像素值的绝对差。如果差异超过 `PIXEL_DIFF_THRESHOLD` (默认 30) 的像素数量占总像素的比例超过 `PIXEL_CHANGE_RATIO_THRESHOLD` (默认 0.005)，则认为发生了显著变化。此方法计算简单快速，但对视频噪声和细微变化较敏感。
- **默认模式 (`default`)**：结合使用感知哈希（pHash）和结构相似性指数（SSIM）进行更鲁棒的检测。
   - **感知哈希 (pHash)**：将图像转换为灰度图，缩放至小尺寸，进行离散余弦变换（DCT），计算DCT系数的中位数，生成二进制哈希指纹。通过计算两帧pHash指纹的汉明距离（Hamming Distance），若距离小于等于 `HAMMING_THRESHOLD_UP` (默认 5)，则认为内容相似。pHash对图像的缩放、轻微模糊、亮度调整等具有较好的鲁棒性。
   - **结构相似性 (SSIM)**：从亮度、对比度、结构三个维度比较两图像的相似性。计算得到的 SSIM 值范围在 -1 到 1 之间，越接近 1 表示越相似。当 SSIM 值大于等于 `SSIM_THRESHOLD` (默认 0.999) 时，认为两帧在结构上高度相似。SSIM 更符合人眼对图像质量的感知。
   - **决策逻辑**：在默认模式下，只有当 pHash 汉明距离 *大于* 阈值 **或** SSIM 值 *小于* 阈值时，才初步判断为潜在的幻灯片切换。
- **二次验证 (`enableDoubleVerification`)**：为减少因短暂遮挡（如鼠标指针、临时通知）导致的误判，启用此选项后，当检测到潜在切换时，系统会缓存当前帧。只有当后续连续 `VERIFICATION_COUNT` (默认 2) 帧与该缓存帧保持足够高的相似度（即 pHash 和 SSIM 均未再次触发切换条件）时，才最终确认该缓存帧为新的幻灯片。

## 故障排除
- **幻灯片未捕获**：尝试降低截取间隔（如果采用二次校验功能，需要幻灯片保持三倍于这个时间稳定才会被截取）；尝试在偏好设置调整截取阈值（不推荐）；尝试关闭快速模式并以1倍速播放。
- **macOS 上的安全警告**：使用安装中提到的 `sudo xattr -d com.apple.quarantine` 命令
- **录播无法播放**：启用"重置播放进度"选项
- **界面元素干扰**：使用自定义屏蔽规则移除干扰元素
- **任务队列卡住**：启用"自动重试错误"并增加最大重试次数
- **已知问题：如果你在截取进行中离开播放页面进入网页**：将可能会触发错误重试功能（无修复计划，因此如果您需要取消任务，应该先手动点击“停止截取”，或直接退出应用）
- **软件出现未知问题了吗**：在偏好设置中重置所有数据试试。

## 条款和条件

1. 软件用途

本软件仅为用户提供便捷的课程资源下载功能，旨在协助北京理工大学“延河课堂”平台的用户在合法授权范围内管理和使用学习资源。本软件不存储、修改或分发任何课程内容，所有下载内容均来源于“延河课堂”平台。

2. 知识产权声明

“延河课堂”平台上的所有课程资源（包括但不限于视频、文档、图片、音频等）的知识产权归原作者、北京理工大学或相关权利人所有。本软件仅作为技术工具，不对平台内容的知识产权归属承担任何责任。用户在使用本软件下载或使用课程资源时，必须严格遵守《中华人民共和国著作权法》及其他相关法律法规，以及“延河课堂”平台的用户协议和知识产权政策。

3. 用户责任

用户应确保其使用本软件的行为符合法律法规及“延河课堂”平台的使用条款。用户不得利用本软件从事以下行为：

- 未经授权复制、分发、修改或传播课程资源；
- 将下载的课程资源用于商业用途或任何非法目的；
- 侵犯任何第三方（包括但不限于北京理工大学、课程作者或其他权利人）的知识产权或其他合法权益。
- 如因用户不当使用本软件导致的任何法律纠纷或知识产权侵权，均由用户自行承担全部责任，软件开发者不对因此产生的任何后果承担责任。

4. 免责条款

- 本软件开发者不对“延河课堂”平台内容的合法性、完整性或准确性作出任何保证。
- 本软件开发者不对因用户使用本软件而导致的任何直接或间接损失（包括但不限于数据丢失、知识产权纠纷等）承担责任。

## 联系我们

如需报告问题或提出建议，请发送邮件至：[info@bitech.edu.kg](mailto:info@bitech.edu.kg)
