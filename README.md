# AutoSlides

[**English Version**](README_EN.md) 👈 Click here for English

`AutoSlides`是一个自动从网页中捕获幻灯片的工具，支持监控内容变化并保存新幻灯片的截图。为北理工延河课堂设计，兼容各类直播/录播平台。
- 基于Electron框架
- 支持Windows/macOS
- 针对延河课堂专门优化


## 简介

AutoSlides是一款专为在线教育设计的智能截图工具，能够自动检测并捕获幻灯片变化，保存为高质量PNG图像。软件采用先进的图像比较算法，精确识别真正的内容变化，避免因视频噪点、弹幕或界面元素导致的误触发。

主要应用场景：
- 在线课程回放时自动保存每张幻灯片
- 直播课程中实时捕获教材内容
- 批量处理多个课程视频并提取所有幻灯片


## 安装

### macOS
1. 根据您的处理器架构，从发布页面下载最新版本：
   - 搭载 Apple Silicon (M1/M2/M3/M4) 处理器的 Mac：下载 `AutoSlide-macOS-arm64.dmg`
   - 搭载 Intel 处理器的 Mac：下载 `AutoSlides-macOS-x86_64.dmg`
2. 打开 DMG 文件并将 AutoSlides 拖到应用程序文件夹
3. 首次运行应用程序时，您可能会收到安全警告。要绕过此警告，请执行以下命令：
   ```bash
   sudo xattr -d com.apple.quarantine /Applications/AutoSlides.app
   ```
4. 现在您可以从应用程序文件夹或启动台打开 AutoSlides

### Windows
1. 根据您的处理器架构，从发布页面下载最新安装程序：
   - ARM 处理器：下载 `AutoSlides--Windows-arm64.7z`
   - Intel/AMD 处理器：下载 `AutoSlides-Windows-x64.7z`
2. 解压并运行`AutoSlides.exe`。


## 使用方法

### 基本功能
1. **网页加载**：输入视频URL或直接从主页选择课程
2. **开始捕获**：点击"开始捕获"按钮，软件会自动监控视频内容变化
3. **幻灯片保存**：检测到新的幻灯片时，会自动截图并保存到指定文件夹
4. **自动命名**：文件会按时间戳和课程名称自动组织和命名

### 高级功能
1. **课程管理**：
   - 自动检测延河课堂的课程列表
   - 支持批量添加录播或直播课程到任务队列
   - 任务队列管理和自动处理

2. **自动化选项**：
   - 自动检测视频结束并停止捕获
   - 自动开始播放视频
   - 自动调整播放速度（可加速到4倍速）
   - 自动检测并提取课程标题信息
   - 自动重试错误播放

3. **快速模式**：
   - 启用后自动以4倍速播放录播内容
   - 缩短检查间隔提高捕获效率
   - 自动重置播放进度

4. **图像处理选项**：
   - 顶部/底部裁剪百分比调整
   - 支持多种图像比较算法切换
   - 双重验证机制避免误捕获

5. **界面优化**：
   - 自定义元素屏蔽规则
   - 自动静音选项
   - 界面暗色模式支持

6. **缓存管理**：
   - 一键清理浏览器缓存
   - 自动清理超时缓存
   - 显示当前缓存大小


## 配置选项

### 基础设置
- **输出目录**：设置幻灯片保存位置
- **检查间隔**：调整内容变化检测频率（秒）
- **网站配置**：针对不同网站的捕获配置文件

### 图像捕获策略
- **裁剪百分比**：设置顶部和底部需要裁剪的百分比
- **比较方法**：选择基本模式或高级感知哈希模式
- **启用双重验证**：需要连续多次检测到变化才会保存，避免误触发

### 自动化设置
- **检测结束**：自动识别视频播放结束并停止捕获
- **自动播放**：自动点击播放按钮开始视频
- **速度调整**：自动设置视频播放速度
- **标题检测**：自动识别并提取课程标题信息

### 批处理选项
- **快速模式**：最大化加速录播内容处理
- **重置进度**：自动重置播放进度，避免跳过内容
- **自动静音**：处理过程中静音播放


## 技术实现

### 图像对比算法
AutoSlides采用多层级图像对比策略，确保准确捕获内容变化：

1. **感知哈希 (pHash)**：
   - 将图像缩放到统一大小后计算DCT变换
   - 提取低频系数生成图像指纹
   - 通过汉明距离比较图像相似度
   - 对视频噪点和压缩伪影具有高度鲁棒性

2. **结构相似性指数 (SSIM)**：
   - 比较图像亮度、对比度和结构信息
   - 通过计算协方差评估结构变化
   - 对轻微图像变化有更好的感知能力

3. **高斯模糊预处理**：
   - 应用高斯模糊减少图像噪点
   - 可调整sigma值控制模糊强度
   - 过滤无关的微小变化

4. **灰度转换**：
   - 将RGB图像转换为灰度，减少计算量
   - 保留图像结构和亮度信息，忽略色彩变化

5. **阈值调整**：
   - 可自定义像素差异阈值
   - 变化比率阈值控制触发敏感度
   - 支持全局或区域性变化检测

### 网页优化技术
1. **元素拦截**：
   - 自定义CSS选择器规则屏蔽干扰元素
   - 适配延河课堂的特定界面元素
   - 动态注入CSS和JavaScript实现即时屏蔽

2. **链接重定向**：
   - 拦截新窗口打开行为
   - 修改target="_blank"链接为同窗口导航
   - 防止页面跳转导致捕获中断

3. **API集成**：
   - 与延河课堂API集成获取课程信息
   - 支持进度重置和会话数据提取
   - 保持用户认证状态

### 缓存和性能优化
1. **定时缓存清理**：
   - 自动清理浏览器缓存防止内存泄漏
   - 可配置清理间隔
   - 支持选择性清理不同类型的缓存数据

2. **并行处理**：
   - 使用主进程和渲染进程分离UI和后台任务
   - 图像处理不阻塞用户界面响应
   - 实现高效的多任务队列处理

3. **资源节约**：
   - 自动静音减少音频处理开销
   - 暗色模式减少屏幕能耗
   - 后台运行时防止系统休眠


## 故障排除
- **幻灯片未捕获**：尝试降低"Change Threshold"阈值
- **macOS 上的安全警告**：使用安装中提到的 `sudo xattr -d com.apple.quarantine` 命令
- **性能问题**：增加"Check Interval"值
- **录播无法播放**：启用"重置播放进度"选项
- **界面元素干扰**：使用自定义屏蔽规则移除干扰元素
- **任务队列卡住**：启用"自动重试错误"并增加最大重试次数